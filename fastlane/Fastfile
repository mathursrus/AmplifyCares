default_platform(:ios)

platform :ios do
  desc "Deploy to TestFlight"
  lane :deploy_to_testflight do
    app_store_connect_api_key(
      key_id: ENV['APPLE_API_KEY_ID'],
      issuer_id: ENV['APPLE_ISSUER_ID'],
      key_content: ENV['FASTLANE_API_KEY']
    )

    build_app(
      workspace: "cordova/platforms/ios/Self care matters.xcworkspace",
      scheme: "Self care matters",
      export_method: 'app-store',
      development_team: ENV['FASTLANE_TEAM_ID'], # Use your Apple Developer Program Team ID
      code_sign_identity: "Apple Development", # Use "Apple Development" for development builds
      export_options: {
        provisioningProfiles: { 
          "com.yourorgcares.amplifycares": "SelfCareMatters-Test"
        }
      }
    )
    
    upload_to_testflight
  end
end
