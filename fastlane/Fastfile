default_platform(:ios)

platform :ios do
  desc "Deploy to TestFlight"
  lane :deploy_to_testflight do
    # Set up the app identifier and other parameters
    app_identifier = "com.yourorgcares.amplifycares" # Replace with your actual app identifier
    
    # Directly use the API key content provided by the environment variable
    app_store_connect_api_key(
      key_id: ENV['APPLE_API_KEY_ID'],
      issuer_id: ENV['APPLE_ISSUER_ID'],
      key_content: ENV['FASTLANE_API_KEY'] # Assuming this contains the .p8 file content directly
    )

    
    # Assuming environment setup takes care of provisioning, you can directly build the app
    build_app(scheme: "Self care matters") # Use the correct scheme
    
    # Upload the build to TestFlight
    upload_to_testflight
  end
end
